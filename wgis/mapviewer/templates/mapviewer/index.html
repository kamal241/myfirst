{% extends "mapviewer/base.html" %}
{% load staticfiles %}

{% block head_css_site %}
    <link href="{% static 'mapviewer/css/bootstrap.min.css' %}" rel="stylesheet" media="screen">
    <link href="{% static 'mapviewer/css/full.css' %}" rel="stylesheet" media="screen">
    <link href="{% static 'mapviewer/css/layersnav.css' %}" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="{% static 'mapviewer/css/ol3-contextmenu.min.css' %}">
    
{% endblock %}


{% block head_js_site %}

<!--<script href="{% static 'mapviewer/js/ol3/ol.js' %}" type="text/javascript"> </script>
    <script href="{% static 'mapviewer/js/jquery-3.1.0.min.js' %}" type="text/javascript"> </script> -->
    <script href="{% static 'mapviewer/js/mapviewer.js' %}" type="text/javascript"> </script> 
    <script src="{% static 'mapviewer/js/ol3-contextmenu.js' %}" type="text/javascript"></script>
    <script  type="text/javascript">
        function SiteLocation(type,lat,lon)
            {
                this.type = type;
                this.lat = lat;
                if (lon<0)
                    {
                        lon = 360 + (lon % 360);
                    }
                this.lon = lon;
            }

	function getDateFromResponse(obj)
		{
		var dt = new Date();
		var tms = obj.timestamp;
		var hr = obj.hours;
		var yr = parseInt(tms.substr(0,4));
		var mn = parseInt(tms.substr(4,2));
		var dy = parseInt(tms.substr(6,2));
		var basehr = parseInt(tms.substr(8,2));
		dt.setFullYear(yr);
		dt.setMonth(parseInt(mn)-1);
		dt.setDate(dy);
		dt.setHours(hr);
		dt.setMinutes(0);
		dt.setSeconds(0);
		dt.setTime(dt.getTime()+ 3600000);
		return dt;
		}

        var sls = [new SiteLocation("DD",-9.642500,9.67083333), 
                    new  SiteLocation("DD",10.5116667,100.286667),
                    new  SiteLocation("DD",4.1023333,103.506500)];
	var wdatatimestamps;
	var noOfWdata = 8;
	var baseReportURL = "http://ec2-54-254-159-111.ap-southeast-1.compute.amazonaws.com:8000/mapviewer/reports/";
	function WeatherData(type, desc, datas)
		{
		this.type = type;
		this.description = desc;
		this.datas = datas;
		this.msgWhileLoading = "Loading " + this.description; 
		this.msgOnSuccess = this.description + "data loaded successfully";
		this.msgOnFailure = this.description + "data could not be loaded";
		}
	
	var wdobjs = [ new WeatherData("TPHA", "Temperature, Pressure, Humidity and Precipitation",["Temp","PRES"]),
		new WeatherData("WIND", "Wind 10m, 925mb, 975mb and gust",["Wind"]),
		new WeatherData("CLOUD", "Cloud cover and Cloud base height",["Cloud Cover","Cloud Base Height"]),
		new WeatherData("SWELLSEAWAVE", "Swell and Sea wave",["Swell","Sea Wave"]),
		new WeatherData("RASTER", "Temperature, Pressure, Humidity and Precipitation [Raster]",["Temp","PRES"])];

	var wddobjs = {};
	wddobjs["tpha"] = new WeatherData("TPHA", "Temperature, Pressure, Humidity and Precipitation",["Temp","PRES"]);
	wddobjs["wind"] = new WeatherData("WIND", "Wind 10m, 925mb, 975mb and gust",["Wind"]);
	wddobjs["cloud"] = new WeatherData("CLOUD", "Cloud cover and Cloud base height",["Cloud Cover","Cloud Base Height"]);
	wddobjs["swave"] = new WeatherData("SWELLSEAWAVE", "Swell and Sea wave",["Swell","Sea Wave"]);
        wddobjs["raster"] = new WeatherData("RASTER", "Temperature, Pressure, Humidity and Precipitation",["Temp","PRES"]);
	var globaldtm;
	var currentDate = new Date();
	var initialDate = new Date();
	var currentDtm;
        var wdata;
        var wind_data = {};
        var sdata;
        var swave_data = {};
        var cindex=0;
        var responseRasterData, responseWS10mContData, responsePRMSLContData, responseTMP2mContData, responseHMDT2mContData, responseAPCPContData;
        var responseSwaveData;
	var loadingInfoMessageQueue = {};
        var windArrows = ["{% static 'mapviewer/images/arrows/gm_arrow.png' %}",
                    "{% static 'mapviewer/images/arrows/bm_arrow.png' %}",
                    "{% static 'mapviewer/images/arrows/rm_arrow.png' %}",
                    "{% static 'mapviewer/images/arrows/up-arrow.png' %}"];

        var waveArrows = ["{% static 'mapviewer/images/arrows/no_dir2.png' %}",
                    "{% static 'mapviewer/images/arrows/gm_arrow.png' %}",
                    "{% static 'mapviewer/images/arrows/bm_arrow.png' %}",
                    "{% static 'mapviewer/images/arrows/rm_arrow.png' %}"];

        var url_marker = "{% static 'mapviewer/images/pin_drop.png' %}";
        var start_map_pin = "{% static 'mapviewer/images/map-marker/start_bb2.png' %}";

        var wind_raw = {"gust":{"type": "FeatureCollection","features": []},"wd_10m":{"type": "FeatureCollection","features": []},"ws_10m":{"type": "FeatureCollection","features": []},"wd_925m":{"type": "FeatureCollection","features": []},"ws_925m":{"type": "FeatureCollection","features": []},"wd_975m":{"type": "FeatureCollection","features": []},"ws_975m":{"type": "FeatureCollection","features": []}};
        wind_data[0] = new Object(); //{"gust":{"type": "FeatureCollection","features": []},"wd_10m":{"type": "FeatureCollection","features": []},"ws_10m":{"type": "FeatureCollection","features": []},"wd_925m":{"type": "FeatureCollection","features": []},"ws_925m":{"type": "FeatureCollection","features": []},"wd_975m":{"type": "FeatureCollection","features": []},"ws_975m":{"type": "FeatureCollection","features": []}};
        wind_data[1] = {"gust":{"type": "FeatureCollection","features": []},"wd_10m":{"type": "FeatureCollection","features": []},"ws_10m":{"type": "FeatureCollection","features": []},"wd_925m":{"type": "FeatureCollection","features": []},"ws_925m":{"type": "FeatureCollection","features": []},"wd_975m":{"type": "FeatureCollection","features": []},"ws_975m":{"type": "FeatureCollection","features": []}};
        wind_data[2] = {"gust":{"type": "FeatureCollection","features": []},"wd_10m":{"type": "FeatureCollection","features": []},"ws_10m":{"type": "FeatureCollection","features": []},"wd_925m":{"type": "FeatureCollection","features": []},"ws_925m":{"type": "FeatureCollection","features": []},"wd_975m":{"type": "FeatureCollection","features": []},"ws_975m":{"type": "FeatureCollection","features": []}};
        wind_data[3] = {"gust":{"type": "FeatureCollection","features": []},"wd_10m":{"type": "FeatureCollection","features": []},"ws_10m":{"type": "FeatureCollection","features": []},"wd_925m":{"type": "FeatureCollection","features": []},"ws_925m":{"type": "FeatureCollection","features": []},"wd_975m":{"type": "FeatureCollection","features": []},"ws_975m":{"type": "FeatureCollection","features": []}};
        wind_data[4] = {"gust":{"type": "FeatureCollection","features": []},"wd_10m":{"type": "FeatureCollection","features": []},"ws_10m":{"type": "FeatureCollection","features": []},"wd_925m":{"type": "FeatureCollection","features": []},"ws_925m":{"type": "FeatureCollection","features": []},"wd_975m":{"type": "FeatureCollection","features": []},"ws_975m":{"type": "FeatureCollection","features": []}};
        wind_data[5] = {"gust":{"type": "FeatureCollection","features": []},"wd_10m":{"type": "FeatureCollection","features": []},"ws_10m":{"type": "FeatureCollection","features": []},"wd_925m":{"type": "FeatureCollection","features": []},"ws_925m":{"type": "FeatureCollection","features": []},"wd_975m":{"type": "FeatureCollection","features": []},"ws_975m":{"type": "FeatureCollection","features": []}};

        $(function() 
            {
            var cindex = 0;
		$("#loadingMessage").hide();
            if (ol.Map.prototype.getLayer === undefined) 
                {    
                ol.Map.prototype.getLayer = function (id) 
                    {
                    var layer;
                    this.getLayers().forEach(function (lyr) 
                        {
                        if (id == lyr.get('layerid')) 
                            {
                            layer = lyr;
                            }            
                        });
                    return layer;
                    }
                }

            function getByName(objs,name)
                {
                var result  = objs.features.filter(
                    function(o)
                        {
                        return o.properties.name == name;
                        });
                    return result? result[0] : null; // or undefined
                 }

            var base_url = "http://ec2-54-254-159-111.ap-southeast-1.compute.amazonaws.com:8000/mapviewer/";
            var vector_url = "http://localhost:8000/mapviewer/weather?lt1=20&lt2=25&ln1=70&ln2=75&dtm=20170114";
            var raster_url = "http://localhost:8000/mapviewer/weather_raster?lt1=20&lt2=25&ln1=70&ln2=75&dtm=2017011400";


            var vector_success = function(data)
                    {
		//	$("#loadingMessage").hide();
		    updateLoadingInfoQueue(0);
                    updateLoadingInfoQueue(1);
		    updateLoadingInfoQueue(2);

                    wdata = data;
                    wind_data = {};
                    cloud_data = {};
		    wdatatimestamps = wdata.properties;
		    var  nof_wdata = wdata.properties.length;
		    var nit=0;
			
		    for(nit=0; nit<nof_wdata; nit++)
			{
			wind_data[nit] = {"gust":{"type": "FeatureCollection","features": []},"wd_10m":{"type": "FeatureCollection","features": []},"ws_10m":{"type": "FeatureCollection","features": []},"wd_925m":{"type": "FeatureCollection","features": []},"ws_925m":{"type": "FeatureCollection","features": []},"wd_975m":{"type": "FeatureCollection","features": []},"ws_975m":{"type": "FeatureCollection","features": []}};
			cloud_data[nit] = {"lcl":{"type": "FeatureCollection","features": []},"mcl":{"type": "FeatureCollection","features": []},"ccl":{"type": "FeatureCollection","features": []},"lcbl":{"type": "FeatureCollection","features": []},"mcbl":{"type": "FeatureCollection","features": []},"ccbl":{"type": "FeatureCollection","features": []}};
			}

                    $.each(wdata.features, 
                        function (key, val)             // All locations
                            {
                            dlocation = val[0].geometry; 
                            dwind = val[0].properties.wind;
                            dcloud = val[0].properties.cloud;

                            $.each(dwind, 
                                function (key2, val2)   // All levels
                                    {
                                    var tpata = {};
                                    var tdata = val2;
                                    $.each(tdata,function(dk,dv)
                                        {
                                        var feature = {};
                                        feature["geometry"] = dlocation;
                                        feature["properties"] = {};
                                        feature["properties"][key2] = dv;
                                        wind_data[dk][key2].features.push(feature);
                                        }); 
                                    });

                            $.each(dcloud, 
                                function (key2, val2)   // All levels
                                    {
                                    var tpata = {};
                                    var tdata = val2;
                                    $.each(tdata,function(dk,dv)
                                        {
                                        var feature = {};
                                        feature["geometry"] = dlocation;
                                        feature["properties"] = {};
                                        feature["properties"][key2] = dv;
                                        cloud_data[dk][key2].features.push(feature);
                                        }); 
                                    });

                            });

                    gustDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(wind_data[0].gust,{'featureProjection':'EPSG:3857'}));
                    windDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(wind_data[0].wd_10m,{'featureProjection':'EPSG:3857'}));
                    wind925DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(wind_data[0].wd_925m,{'featureProjection':'EPSG:3857'}));
                    wind975DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(wind_data[0].wd_975m,{'featureProjection':'EPSG:3857'}));
                    lclCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[0].lcl,{'featureProjection':'EPSG:3857'}));
                    mclCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[0].mcl,{'featureProjection':'EPSG:3857'}));
                    cclCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[0].ccl,{'featureProjection':'EPSG:3857'}));
                    lcblCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[0].lcbl,{'featureProjection':'EPSG:3857'}));
                    mcblCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[0].mcbl,{'featureProjection':'EPSG:3857'}));
                    ccblCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[0].ccbl,{'featureProjection':'EPSG:3857'}));

                    };

            var raster_success = function(datas)
                    {
		    updateLoadingInfoQueue(4);
                    responseRasterData = datas;
                    data = datas.features[0];
                    responseWS10mContData = getByName(data,'WS10m');

                    ws10mContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseWS10mContData,{'featureProjection':'EPSG:3857'}));
                            
                        
                    responsePRMSLContData = getByName(data,'PRMSL');

                    prContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responsePRMSLContData,{'featureProjection':'EPSG:3857'}));
                            
                    responseTMP2mContData = getByName(data,'TMP2m');
                    tmp2mContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseTMP2mContData,{'featureProjection':'EPSG:3857'}));
                            
                    responseHMDT2mContData = getByName(data,'HMDT2m');
                    hmdt2mContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseHMDT2mContData,{'featureProjection':'EPSG:3857'}));
                    
                    responseAPCPContData = getByName(data,'APCP');
                    apcpContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseAPCPContData,{'featureProjection':'EPSG:3857'}));

                    };

            var swave_success = function(data)
                    {
                    updateLoadingInfoQueue(3);
		    responseSwaveData = data;
                    sdata = data;
		    var nof_sdata = sdata.features[0].properties.dsw1.length;
                    var nit=0;

                    for(sit=0; sit<nof_sdata; sit++)
                        {
			swave_data[sit] = {"dsw1":{"type": "FeatureCollection","features": []},"hsw1":{"type": "FeatureCollection","features": []},"tsw1":{"type": "FeatureCollection","features": []},"dsw2":{"type": "FeatureCollection","features": []},"hsw2":{"type": "FeatureCollection","features": []},"tsw2":{"type": "FeatureCollection","features": []},"perpws":{"type": "FeatureCollection","features": []},"mpww":{"type": "FeatureCollection","features": []},"swhs":{"type": "FeatureCollection","features": []},"dirpws":{"type": "FeatureCollection","features": []},"shwws":{"type": "FeatureCollection","features": []}};
                        }

			/*	
                    swave_data[0] = {"dsw1":{"type": "FeatureCollection","features": []},"hsw1":{"type": "FeatureCollection","features": []},"tsw1":{"type": "FeatureCollection","features": []},"dsw2":{"type": "FeatureCollection","features": []},"hsw2":{"type": "FeatureCollection","features": []},"tsw2":{"type": "FeatureCollection","features": []},"perpws":{"type": "FeatureCollection","features": []},"mpww":{"type": "FeatureCollection","features": []},"swhs":{"type": "FeatureCollection","features": []},"dirpws":{"type": "FeatureCollection","features": []},"shwws":{"type": "FeatureCollection","features": []}};
                    swave_data[1] = {"dsw1":{"type": "FeatureCollection","features": []},"hsw1":{"type": "FeatureCollection","features": []},"tsw1":{"type": "FeatureCollection","features": []},"dsw2":{"type": "FeatureCollection","features": []},"hsw2":{"type": "FeatureCollection","features": []},"tsw2":{"type": "FeatureCollection","features": []},"perpws":{"type": "FeatureCollection","features": []},"mpww":{"type": "FeatureCollection","features": []},"swhs":{"type": "FeatureCollection","features": []},"dirpws":{"type": "FeatureCollection","features": []},"shwws":{"type": "FeatureCollection","features": []}};
                    swave_data[2] = {"dsw1":{"type": "FeatureCollection","features": []},"hsw1":{"type": "FeatureCollection","features": []},"tsw1":{"type": "FeatureCollection","features": []},"dsw2":{"type": "FeatureCollection","features": []},"hsw2":{"type": "FeatureCollection","features": []},"tsw2":{"type": "FeatureCollection","features": []},"perpws":{"type": "FeatureCollection","features": []},"mpww":{"type": "FeatureCollection","features": []},"swhs":{"type": "FeatureCollection","features": []},"dirpws":{"type": "FeatureCollection","features": []},"shwws":{"type": "FeatureCollection","features": []}};
                    swave_data[3] = {"dsw1":{"type": "FeatureCollection","features": []},"hsw1":{"type": "FeatureCollection","features": []},"tsw1":{"type": "FeatureCollection","features": []},"dsw2":{"type": "FeatureCollection","features": []},"hsw2":{"type": "FeatureCollection","features": []},"tsw2":{"type": "FeatureCollection","features": []},"perpws":{"type": "FeatureCollection","features": []},"mpww":{"type": "FeatureCollection","features": []},"swhs":{"type": "FeatureCollection","features": []},"dirpws":{"type": "FeatureCollection","features": []},"shwws":{"type": "FeatureCollection","features": []}};
                    swave_data[4] = {"dsw1":{"type": "FeatureCollection","features": []},"hsw1":{"type": "FeatureCollection","features": []},"tsw1":{"type": "FeatureCollection","features": []},"dsw2":{"type": "FeatureCollection","features": []},"hsw2":{"type": "FeatureCollection","features": []},"tsw2":{"type": "FeatureCollection","features": []},"perpws":{"type": "FeatureCollection","features": []},"mpww":{"type": "FeatureCollection","features": []},"swhs":{"type": "FeatureCollection","features": []},"dirpws":{"type": "FeatureCollection","features": []},"shwws":{"type": "FeatureCollection","features": []}};
                    swave_data[5] = {"dsw1":{"type": "FeatureCollection","features": []},"hsw1":{"type": "FeatureCollection","features": []},"tsw1":{"type": "FeatureCollection","features": []},"dsw2":{"type": "FeatureCollection","features": []},"hsw2":{"type": "FeatureCollection","features": []},"tsw2":{"type": "FeatureCollection","features": []},"perpws":{"type": "FeatureCollection","features": []},"mpww":{"type": "FeatureCollection","features": []},"swhs":{"type": "FeatureCollection","features": []},"dirpws":{"type": "FeatureCollection","features": []},"shwws":{"type": "FeatureCollection","features": []}};
			*/
                    $.each(sdata.features, 
                        function (key, val)             // All locations
                            {
                            dlocation = val.geometry; 
                            swdata = val.properties;
                            $.each(swdata, 
                                function (key2, val2)   // All levels
                                    {
                                    var tpata = {};
                                    var tdata = val2;
                                    $.each(tdata,function(dk,dv)
                                        {
                                        var feature = {};
                                        feature["geometry"] = dlocation;
                                        feature["properties"] = {};
                                        feature["properties"][key2] = {};
                                        feature["properties"][key2] = dv;
                                        swave_data[dk][key2].features.push(feature);
                                        }); 
                                    });
                            });

                    dsw1DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].dsw1,{'featureProjection':'EPSG:3857'}));
                    dsw2DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].dsw2,{'featureProjection':'EPSG:3857'}));
                    hsw1DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].hsw1,{'featureProjection':'EPSG:3857'}));  
                    hsw2DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].hsw2,{'featureProjection':'EPSG:3857'}));
                    tsw1DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].tsw1,{'featureProjection':'EPSG:3857'}));
                    tsw2DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].tsw2,{'featureProjection':'EPSG:3857'}));
                    whgtDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].shwws,{'featureProjection':'EPSG:3857'}));
                    swperDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].perpws,{'featureProjection':'EPSG:3857'}));
                    mpwwDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].mpww,{'featureProjection':'EPSG:3857'}));
                    dirpwsDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].dirpws,{'featureProjection':'EPSG:3857'}));
                    swhsDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].swhs,{'featureProjection':'EPSG:3857'}));
                    maxswhsDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[0].swhs,{'featureProjection':'EPSG:3857'}));
                    /*    
                    responseWS10mContData = getByName(data,'WS10m');

                    ws10mContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseWS10mContData,{'featureProjection':'EPSG:3857'}));
                            
                        
                    responsePRMSLContData = getByName(data,'PRMSL');

                    prContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responsePRMSLContData,{'featureProjection':'EPSG:3857'}));
                            
                    responseTMP2mContData = getByName(data,'TMP2m');
                    tmp2mContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseTMP2mContData,{'featureProjection':'EPSG:3857'}));
                            
                    responseHMDT2mContData = getByName(data,'HMDT2m');
                    hmdt2mContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseHMDT2mContData,{'featureProjection':'EPSG:3857'}));
                    
                    responseAPCPContData = getByName(data,'APCP');
                    apcpContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseAPCPContData,{'featureProjection':'EPSG:3857'}));
                    */
                    };

            function getTimeStampForData(toff) 
                {
		toff=0;
                var now = new Date();
                var cdate = new Date(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),  now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds());
		currentDate = new Date(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),  now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds()); //new Date(cdate.toUTCString());
		initialDate = new Date(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(),  now.getUTCHours() , now.getUTCMinutes(), now.getUTCSeconds()); //new Date(cdate.toUTCString());
		currentDate.setHours(currentDate.getHours()+toff);
		initialDate.setHours(initialDate.getHours()+toff);
                var tzoffset = cdate.getTimezoneOffset();
                var fcids = ['00','06','12','18'];
                var hrs = cdate.getHours();
		console.log("Hrs " + hrs);
                var dohrs = hrs - 5;
		console.log("doHrs " + dohrs);
                var cday = cdate.getDay();
                if (dohrs<0)
                    {
                    cdate = new Date((new Date).valueOf() - 86350989);
		    dohrs = 24 + dohrs;
                    cdate.setHours(dohrs);
                    }
                else
                    {
                    cdate.setHours(dohrs);
                    }
		console.log("idx " + dohrs/6);
                var didx = fcids[parseInt(dohrs/6)];
               // var didx = fcids[1];
		console.log("Hrs " + didx);

                var mnth = cdate.getMonth()+1;
                var day = cdate.getDate();
                var dtm = cdate.getFullYear().toString()+(mnth<10?("0" + mnth.toString()):mnth.toString()) +(day<10?("0" + day.toString()):day.toString()) + didx;
                return dtm;
                }

            function addLocation(obj)
                {
                //console.log(obj);
                var template = '[ {x} | {y} ]';
                var iconStyle = new ol.style.Style({
                    image: new ol.style.Icon({
                    scale: .6,
                    src: url_marker
                    }),
                    text: new ol.style.Text({
                    offsetY: 25,
                //    text: ol.coordinate.format(obj, template, 2),
                    font: '15px Open Sans,sans-serif',
                    fill: new ol.style.Fill({ color: '#111' }),
                    stroke: new ol.style.Stroke({
                      color: '#eee', width: 2
                    })
                    })
                    });
                var feature = new ol.Feature({
                      type: 'removable',
                      geometry: new ol.geom.Point(obj)
                    });
                      
                feature.setStyle(iconStyle);
                siteSelectionVectorLayer.getSource().clear();
                siteSelectionVectorLayer.getSource().addFeature(feature);
                map.getView().setCenter(obj);

                }

            $('#location1').click(function (e) 
                {
                    //alert(sls[0].lat + "" + sls[0].lon);
                    var coord4326 = ol.proj.transform([sls[0].lon, sls[0].lat], 'EPSG:4326', 'EPSG:3857');
                    targetSiteLocation = [sls[0].lon, sls[0].lat];
                    addLocation(coord4326);
                });

            $('#location2').click(function (e) 
                {
                    //alert(sls[1].lat + "" + sls[1].lon);
                    var coord4326 = ol.proj.transform([sls[1].lon, sls[1].lat], 'EPSG:4326', 'EPSG:3857');
                    targetSiteLocation = [sls[1].lon, sls[1].lat];
                    addLocation(coord4326);
                });

            $('#location3').click(function (e) 
                {
                    //alert(sls[2].lat + "" + sls[2].lon);
                    var coord4326 = ol.proj.transform([sls[2].lon, sls[2].lat], 'EPSG:4326', 'EPSG:3857');
                    targetSiteLocation = [sls[2].lon, sls[2].lat];
                    addLocation(coord4326);
                });            

	    function displayLoadingInfo()
		{
		var loadingInfoMessage = "";
		if (Object.keys(loadingInfoMessageQueue).length > 0)
			{
			for(var key in loadingInfoMessageQueue)
	                        {
				var tobj = loadingInfoMessageQueue[key];
				loadingInfoMessage = loadingInfoMessage + "<span>" + tobj.msgWhileLoading + "</span><br>";
	                        }
//			console.log(loadingInfoMessage);
			$("#loadingMessage").html(loadingInfoMessage);
			$("#loadingMessage").show();
			}
		else
			{
			$("#loadingMessage").hide();
			alert("TPHA, Wind, Cloud and Sea Wave data loaded successfully.\n Select layers to view from left panel.");
			}
		}

	    function addToLoadingInfoQueue(msgForData)
		{
		loadingInfoMessageQueue[wdobjs[msgForData].type] = wdobjs[msgForData];
//		loadingInfoMessageQueue.push(wdobjs[msgForData]);
		displayLoadingInfo();
//		loadingInfoMessage = loadingInfoMessage + loadigInfoMessages[msgForData];
//		$("#loadingMessage")
		}

	    function updateLoadingInfoQueue(msgForData)
                {
                delete loadingInfoMessageQueue[wdobjs[msgForData].type];
                displayLoadingInfo();
//              loadingInfoMessage = loadingInfoMessage + loadigInfoMessages[msgForData];
//              $("#loadingMessage")
                }

	    function toDisplayDate(dtm)
		{
//		var sdt = "";
//		var sdt = new Date(dtm.substr(0,4)+"-"+dtm.substr(4,2)+"-"+dtm.substr(6,2));
//		sdt.setHours(dtm.substr(8,2));
//		currentDate = sdt;
//		return sdt;
		return currentDate;
		}

	function getTZOffset(ln)  
		{    
		var lnf=0;var lnr=0;var nln =0;
		lnf = parseInt(ln/180); 
		lnr = 0;    
		var tzoffset=0;    
		if(lnf==1)
		    	{
		      	nln=360-ln;     
		      	lnr=-1;     
		     	tzoffset=lnr * parseInt(nln/15);
		    	}    
		if(lnf==0)     
			{     
		      	nln=ln;     
		      	lnr=1;     
		      	tzoffset=lnr * parseInt(nln/15);
			} 
		   return tzoffset;  
		}



            $('#loadData').click(function (e) 
                {
		if(targetSiteLocation != undefined)
			{
                var lt = targetSiteLocation[1];
                var ln = targetSiteLocation[0]%360;

                if (ln<0)
                    {
                        ln = 360 + (ln % 360);
                    }

		var tzo = getTZOffset(ln);
		var dtm = getTimeStampForData(tzo);
                currentDtm = dtm;
                var sdt = toDisplayDate(dtm);
                $("#wdTimeStamp").html(currentDate.toUTCString());
		console.log(cindex + ":" + tzo  + " : " + currentDate + ":" +initialDate);

                var lt1,lt2,ln1,ln2;   
                lt1 = lt - 2.5;
                lt2 = lt + 2.5;
                ln1 = ln - 2.5;
                ln2 = ln + 2.5;

                vector_url = base_url + "weather?lt1=" + lt1 + "&lt2=" + lt2 + "&ln1=" + ln1 + "&ln2=" + ln2 + "&dtm=" + dtm; //20170106";
                
                raster_url = base_url + "weather_raster?lt1=" + lt1 + "&lt2=" + lt2 + "&ln1=" + ln1 + "&ln2=" + ln2 + "&dtm=" + dtm; //"&dtm=2017010600";

                swave_url = base_url + "weather_swave?lt1=" + lt1 + "&lt2=" + lt2 + "&ln1=" + ln1 + "&ln2=" + ln2 + "&dtm=" + dtm; //"2017030906"; //dtm;



                $.ajax({
                    dataType: 'json',
                    url: vector_url,
                    success: vector_success,
                    beforesend: (function() 
					{
					addToLoadingInfoQueue(0);
					addToLoadingInfoQueue(1);
					addToLoadingInfoQueue(2);
					}
				)()	//$("#loadingMessage").show()
		    });

                $.ajax({
                    dataType: 'json',
                    url: raster_url,
                    success: raster_success,
		    beforesend : addToLoadingInfoQueue(4)
                    });

                $.ajax({
                    dataType: 'json',
                    url: swave_url,
                    success: swave_success,
		    beforesend : addToLoadingInfoQueue(3)
                    });
		}
		else
			{
			alert("Please specify the location first.");
			}
		
                });

            $("#genReport").click(
	            function()
        	            {
		            if (targetSiteLocation==undefined)
                	        {
	                        alert("Please Set Site Location. Right Click on Map and choose Set Site Location");
	                        }
	                    else
            	                {
				if(currentDtm==undefined)
					{
			alert("Please load data before generating report. To load data click on Load from top panel");
					}
				else
					{
					var getReqPara = "";  
	        	                getReqPara = getReqPara + "&lon=" + targetSiteLocation[0]%360;
	                	        getReqPara = getReqPara + "&lat=" + targetSiteLocation[1];
					getReqPara = getReqPara + "&dtm=" + currentDtm;
		                        //alert(baseReportURL + "location?" + getReqPara);
		                        var siteLocReportURL = baseReportURL + "location?" + getReqPara;
					console.log(siteLocReportURL);
	alert("The report will open in new Window/Tab. Do not close new Window/Tab. \n Report generation may take bit longer.\n Kindly be patient");                   
				        window.open(siteLocReportURL,"_blank");
	        	                }
				}
                	    });


            $('#nextData').click(function (e) 
                {
                try 
                    {

			cindex=cindex+1;
                    wind10mLayer.getSource().clear();
                    windGustLayer.getSource().clear();
                    wind925mbLayer.getSource().clear();
                    wind975mbLayer.getSource().clear();

                    windDataSource.clear();
                    gustDataSource.clear();
                    wind925DataSource.clear();
                    wind975DataSource.clear();

                    windDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(wind_data[cindex%noOfWdata].wd_10m,{'featureProjection':'EPSG:3857'}));
                    gustDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(wind_data[cindex%noOfWdata].gust,{'featureProjection':'EPSG:3857'}));           
                    wind925DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(wind_data[cindex%noOfWdata].wd_925m,{'featureProjection':'EPSG:3857'}));
                    wind975DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(wind_data[cindex%noOfWdata].wd_975m,{'featureProjection':'EPSG:3857'}));

                    tcdcLowLayer.getSource().clear();
                    tcdcMiddleLayer.getSource().clear();
                    tcdcConvectiveLayer.getSource().clear();

                    lclCloudDataSource.clear();
                    mclCloudDataSource.clear();
                    cclCloudDataSource.clear();

                    lclCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[cindex%noOfWdata].lcl,{'featureProjection':'EPSG:3857'}));
                    mclCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[cindex%noOfWdata].mcl,{'featureProjection':'EPSG:3857'}));
                    cclCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[cindex%noOfWdata].ccl,{'featureProjection':'EPSG:3857'}));

                    presLowLayer.getSource().clear();
                    presMiddleLayer.getSource().clear();
                    presConvectiveLayer.getSource().clear();

                    lcblCloudDataSource.clear();
                    mcblCloudDataSource.clear();
                    ccblCloudDataSource.clear();

                    lcblCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[cindex%noOfWdata].lcbl,{'featureProjection':'EPSG:3857'}));
                    mcblCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[cindex%noOfWdata].mcbl,{'featureProjection':'EPSG:3857'}));
                    ccblCloudDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(cloud_data[cindex%noOfWdata].ccbl,{'featureProjection':'EPSG:3857'}));

                    dsw1DataSource.clear();
                    dsw2DataSource.clear();
                    hsw1DataSource.clear();
                    hsw2DataSource.clear();
                    tsw1DataSource.clear();
                    tsw2DataSource.clear();
                    whgtDataSource.clear();
                    swperDataSource.clear();
                    mpwwDataSource.clear();
                    dirpwsDataSource.clear();
                    swhsDataSource.clear();
                    maxswhsDataSource.clear();


                    dsw1DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].dsw1,{'featureProjection':'EPSG:3857'}));
                    dsw2DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].dsw2,{'featureProjection':'EPSG:3857'}));
                    hsw1DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].hsw1,{'featureProjection':'EPSG:3857'}));  
                    hsw2DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].hsw2,{'featureProjection':'EPSG:3857'}));
                    tsw1DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].tsw1,{'featureProjection':'EPSG:3857'}));
                    tsw2DataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].tsw2,{'featureProjection':'EPSG:3857'}));
                    whgtDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].shwws,{'featureProjection':'EPSG:3857'}));
                    swperDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].perpws,{'featureProjection':'EPSG:3857'}));
                    mpwwDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].mpww,{'featureProjection':'EPSG:3857'}));
                    dirpwsDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].dirpws,{'featureProjection':'EPSG:3857'}));
                    swhsDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].swhs,{'featureProjection':'EPSG:3857'}));
                    maxswhsDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(swave_data[cindex%noOfWdata].swhs,{'featureProjection':'EPSG:3857'}));

                    var data = responseRasterData.features[cindex%noOfWdata];
                    responseWS10mContData = getByName(data,'WS10m');
                    ws10mContDataSource.clear();
                    ws10mContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseWS10mContData,{'featureProjection':'EPSG:3857'}));
                            
                        
                    responsePRMSLContData = getByName(data,'PRMSL');
                    prContDataSource.clear();
                    prContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responsePRMSLContData,{'featureProjection':'EPSG:3857'}));
                            
                    responseTMP2mContData = getByName(data,'TMP2m');
                    tmp2mContDataSource.clear();
                    tmp2mContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseTMP2mContData,{'featureProjection':'EPSG:3857'}));
                            
                    responseHMDT2mContData = getByName(data,'HMDT2m');
                    hmdt2mContDataSource.clear();
                    hmdt2mContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseHMDT2mContData,{'featureProjection':'EPSG:3857'}));
                    
                    responseAPCPContData = getByName(data,'APCP');
                    apcpContDataSource.clear();
                    apcpContDataSource.addFeatures(layerDataGeoJSONFormat.readFeatures(responseAPCPContData,{'featureProjection':'EPSG:3857'}))

		    var ctms = getDateFromResponse(wdatatimestamps[cindex%noOfWdata]).toString();
		    $("#wdTimeStamp").html(ctms.substr(0,ctms.lastIndexOf("GMT")));
		    var dtstr = currentDate.toString();
//		    $("#wdTimeStamp").html(dtstr.substr(0,dtstr.lastIndexOf("GMT")));
		    currentDate.setHours(currentDate.getHours() + 3);
//                    cindex=cindex+1;

		    console.log(cindex + " : " + currentDate + ":" +initialDate);		
		    if(cindex%noOfWdata==0)
                        {
                        currentDate = new Date(initialDate);	//toDisplayDate(currentDtm);
			console.log(currentDate);
//                	getDateFromResponse(wdatatimestamps[cindex]);
		        }


                   // console.log(cindex%4);
                    }
                catch(err)
                    {
                    console.log(err.message);
                    cindex=cindex+1;
                    }
                });


            $("#layerslistnav ul.nav li.parent > a > span.sign").click(function(){          
                $(this).find('i:first').toggleClass("icon-minus");      
                }); 
        
            // Open Le current menu
            $("#layerslistnav ul.nav li.parent.active > a > span.sign").find('i:first').addClass("icon-minus");
            $("#layerslistnav ul.nav li.current").parents('ul.children').addClass("in");

            });
     </script>
{% endblock %}

{% block navigation_site %}
        <nav>
            <div id="layersnav" class="leftnavmenu">
                <div class="panel-group" id="accordion">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h1 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                          Location
                        </a>
                      </h1>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse">
                      <div class="panel-body btn-group" role="group">
                        <span class="glyphicon glyphicon-map-marker btn-lg"></span>
                        <button id="location1" type="button" class="btn btn-default" >
                            09° 38’ 33” S / 09° 40’ 15” E
                        </button>
                        <span class="divider"></span>
                        <span class="glyphicon glyphicon-map-marker btn-lg"></span>
                        <button id="location2" type="button" class="btn btn-default" >
                            10⁰ 30' 42” N / 100⁰ 17’ 12” E
                        </button>
                        <span class="divider"></span>
                        <span class="glyphicon glyphicon-map-marker btn-lg"></span>
                        <button id="location3" type="button" class="btn btn-default" >
                            04° 06.140' N / 103° 30.390' E
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h5 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
                          Layers
                        </a>
                      </h5>
                    </div>
                    <div id="collapseTwo" class="panel-collapse collapse">
                      <div class="panel-body">
                        <label>TPHA</label>
                        <span class="divider"></span>
                        <div class="checkbox">
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="temprature2mCPVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Temperature
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="pressureMSLILVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Pressure                        
                            </label>
                        </div>
                        <div class="checkbox ">
                            <label  class="col-md-6">
                                <input type="checkbox" value="" id="humidity2mCPVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Humidity
                            </label>
                            <label  class="col-md-6">
                                <input type="checkbox" value="" id="apcpVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>APCP
                            </label>
                        </div>
                        <label class="layerLabel">Wind (Knots)</label>
                        <span class="divider"></span>
                        <div class="checkbox">
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="wind10mVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>10 m Dir
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="wind10mCPVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>10 m CP
                            </label>
                        </div>
                        <div class="checkbox ">
                            <label class="col-md-6">
                                <input type="checkbox" value=""  id="wind925mbVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>925 mb
                            </label>
                            <label  class="col-md-6">
                                <input type="checkbox" value="" id="wind975mbVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>975 mb
                            </label>
                        </div>
                        <div class="checkbox ">
                            <label  class="col-md-6">
                                <input type="checkbox" value="" id="windGustVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Gust
                            </label>
                        </div>
                        <label class="layerLabel" >Cloud Cover (%)</label>
                        <span class="divider"></span>
                        <div class="checkbox">
                            <label class="col-md-6">
                                <input type="checkbox" value=""  id="tcdcLowVisible">
                                <span class="cr">
                                    <i class="cr-icon glyphicon glyphicon-ok"></i>
                                </span>Low (%)
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value=""  id="tcdcMiddleVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Middle (%)
                            </label>
                        </div>
                        <div class="checkbox ">
                            <label  class="col-md-6">
                                <input type="checkbox" value="" id="tcdcConvectiveVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Convective (%)
                            </label>  
                        </div>
                        <label class="layerLabel">Cloud Base Height (feet)</label>
                        <span class="divider"></span>
                        <div class="checkbox">
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="presLowVisible">
                                <span class="cr">
                                    <i class="cr-icon glyphicon glyphicon-ok"></i>
                                </span>Low (feet)
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="presMiddleVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Middle (feet)
                            </label>
                        </div>
                        <div class="checkbox ">
                            <label  class="col-md-6">
                                <input type="checkbox" value="" id="presConvectiveVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>High (feet)
                            </label>  
                        </div>
                        <label class="layerLabel">Swell</label>
                        <span class="divider"></span>
                        <div class="checkbox">
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="dsw1Visible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Primary Dir
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value=""  id="dsw2Visible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Secondary Dir
                            </label>
                        </div>
                        <div class="checkbox ">
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="tsw1Visible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Primary Period (s)
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="tsw2Visible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Secondary Period (s)
                            </label>        
                        </div>
                        <div class="checkbox ">
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="hsw1Visible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Primary Height (m)
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="hsw2Visible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Secondary Height (m)
                            </label>        
                        </div>
                        <label class="layerLabel">Sea Wave</label>
                        <span class="divider"></span>
                        <div class="checkbox">
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="swhgtVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Wave Height
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="perpwsVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Period (s)
                            </label>
                        </div>
                        <div class="checkbox ">
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="dirpwsVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Direction Peak (s)
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="mpwwVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Period Peak (s)
                            </label>        
                        </div>
                        <div class="checkbox ">
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="swhsVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Significant Height (m)
                            </label>
                            <label class="col-md-6">
                                <input type="checkbox" value="" id="maxshwsVisible">
                                <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Max Height (m)
                            </label>        
                        </div>     
                        <!--
			<button id="loadData" type="button" class="btn btn-primary" > Load </button>           
			<button id="nextData" type="button" class="btn btn-primary" > > </button>                    
			-->
                      </div>
                    </div>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h5 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
                          Reports
                        </a>
                      </h5>
                    </div>
                    <div id="collapseThree" class="panel-collapse collapse">
                      <div class="panel-body">
		<button type="button" class="btn btn-info"  name="genReport" id="genReport" > Location Report</button>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
      

                <!--<div id="layersnav" class="leftnavmenu">
                    <button id="loadData" type="button" class="btn btn-primary" > Load </button>
                    <span class="divider"></span>                
                    <div class="checkbox">
                        <label class="col-md-6">
                            <input type="checkbox" value="">
                            <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Temperature
                        </label>
                        <label class="col-md-6">
                            <input type="checkbox" value="" checked>
                            <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Pressure                        
                        </label>
                    </div>
                    <div class="checkbox ">
                        <label  class="col-md-6">
                            <input type="checkbox" value="">
                            <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>Humidity
                        </label>
                        <label  class="col-md-6">
                            <input type="checkbox" value="">
                            <span class="cr"><i class="cr-icon glyphicon glyphicon-ok"></i></span>APCP
                        </label>
                    </div>

                </div> -->
        </nav>

        <nav>
            <div id="mySideRightnav" class="rightnavmenu">
            </div>
        </nav>

        <nav>
            <div id="mySideTopnav" class="topnavmenu">
        	<!--
	        <div class="row">
                    <div class="col-md-12 col-md-offset-2 text-center">
                        <div class="btn-toolbar" role=toolbar aria-label="Toolbar with button groups"> 
                            <div class="btn-group" role=group aria-label="First group"> 
                                <button type=button class="btn btn-default">00</button> 
                                <button type=button class="btn btn-default">03</button> 
                                <button type=button class="btn btn-default">06</button> 
                                <button type=button class="btn btn-default">09</button> 
                                <button type=button class="btn btn-default">12</button> 
                                <button type=button class="btn btn-default">15</button> 
                                <button type=button class="btn btn-default">18</button> 
                                <button type=button class="btn btn-default">21</button> 
                            </div> 
                            
                            <div class=btn-group role=group aria-label="Second group"> 
                                <button type=button class="btn btn-default">00</button> 
                                <button type=button class="btn btn-default">03</button> 
                                <button type=button class="btn btn-default">06</button> 
                                <button type=button class="btn btn-default">09</button> 
                                <button type=button class="btn btn-default">12</button> 
                                <button type=button class="btn btn-default">15</button> 
                                <button type=button class="btn btn-default">18</button> 
                                <button type=button class="btn btn-default">21</button>
                            </div> 
                            
                            <div class=btn-group role=group aria-label="Third group"> 
                                <button type=button class="btn btn-default">00</button> 
                                <button type=button class="btn btn-default">03</button> 
                                <button type=button class="btn btn-default">06</button> 
                                <button type=button class="btn btn-default">09</button> 
                                <button type=button class="btn btn-default">12</button> 
                                <button type=button class="btn btn-default">15</button> 
                                <button type=button class="btn btn-default">18</button> 
                                <button type=button class="btn btn-default">21</button>
                            </div> 
                            <div class=btn-group role=group aria-label="Third group"> 
                                <button type=button class="btn btn-default">00</button> 
                                <button type=button class="btn btn-default">03</button> 
                                <button type=button class="btn btn-default">06</button> 
                                <button type=button class="btn btn-default">09</button> 
                                <button type=button class="btn btn-default">12</button> 
                                <button type=button class="btn btn-default">15</button> 
                                <button type=button class="btn btn-default">18</button> 
                                <button type=button class="btn btn-default">21</button>
                            </div> 
                            <div class=btn-group role=group aria-label="Third group"> 
                                <button type=button class="btn btn-default">00</button> 
                                <button type=button class="btn btn-default">03</button> 
                                <button type=button class="btn btn-default">06</button> 
                                <button type=button class="btn btn-default">09</button> 
                                <button type=button class="btn btn-default">12</button> 
                                <button type=button class="btn btn-default">15</button> 
                                <button type=button class="btn btn-default">18</button> 
                                <button type=button class="btn btn-default">21</button>
                            </div>
                        </div>
                    </div>
                </div> -->
		<div class="row">
			<div class="col-md-8 col-md-offset-2">
	                <button id="loadData" type="button" class="btn btn-primary btn-sm"> Load </button>
		    <!--    <button id="prevData" type="button" class="btn btn-primary btn-sm" > < </button> -->
			<span id="wdTimeStamp" class="label label-info">Timestamp goes here</span>
			<button id="nextData" type="button" class="btn btn-primary btn-sm" > > </button>
			</div>
		</div>
<!--            <div class="table-responsive">
                    <table class="table  table-bordered">
                        <tr class="text-center">
                            <th colspan="8" class="text-center">MONDAY</th>
                            <th colspan="8" class="text-center">TUESDAY</th>
                            <th colspan="8" class="text-center">WEDNESDAY</th>
                            <th colspan="8" class="text-center">THURSDAY</th>
                            <th colspan="8" class="text-center">FRIDAY</th>
                            <th colspan="4" class="text-center">SATURDAY</th> 
                            <th colspan="4" class="text-center">SUNDAY</th>                                                        
                        </tr>
                        <tr>
                            <td>00</td>
                            <td>03</td>
                            <td>06</td>
                            <td>09</td>
                            <td>12</td>                                                                                                                
                            <td>15</td>
                            <td>18</td>
                            <td>21</td>

                            <td>00</td>
                            <td>03</td>
                            <td>06</td>
                            <td>09</td>
                            <td>12</td>                                                                                                                
                            <td>15</td>
                            <td>18</td>
                            <td>21</td>
                            
                            <td>00</td>
                            <td>03</td>
                            <td>06</td>
                            <td>09</td>
                            <td>12</td>                                                                                                                
                            <td>15</td>
                            <td>18</td>
                            <td>21</td>
                            
                            <td>00</td>
                            <td>03</td>
                            <td>06</td>
                            <td>09</td>
                            <td>12</td>                                                                                                                
                            <td>15</td>
                            <td>18</td>
                            <td>21</td>
                            
                            <td>00</td>
                            <td>03</td>
                            <td>06</td>
                            <td>09</td>
                            <td>12</td>                                                                                                                
                            <td>15</td>
                            <td>18</td>
                            <td>21</td>
                            
                            <td>00</td>
                            <td>06</td>
                            <td>12</td>
                            <td>18</td>

                            <td>00</td>
                            <td>06</td>
                            <td>12</td>
                            <td>18</td>
                        </tr>
                    </table> 
                </div>-->
            </div>
                <!--
                <div class="col-md-1">
                    <div class="tcenter btn-group" id="navplayer">          
                        <a href="#" class="btn btn-inverse"><i class="glyphicon glyphicon-backward"></i></a>
                        <a href="#" class="btn btn-inverse"><i class="glyphicon glyphicon-stop"></i></a>
                        <a href="#" class="btn btn-inverse"><i class="glyphicon glyphicon-play"></i></a>
                        <a href="#" class="btn btn-inverse"><i class="glyphicon glyphicon-forward"></i></a>             
                    </div>
                </div>
                <div class="container col-md-5">
                    <div class="row">
                        <div class="col">
                          1 of 3
                        </div>
                        <div class="col-6">
                          2 of 3 (wider)
                        </div>
                        <div class="col">
                          3 of 3
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                          1 of 3
                        </div>
                        <div class="col-5">
                          2 of 3 (wider)
                        </div>
                        <div class="col">
                          3 of 3
                        </div>
                    </div>
                </div> -->            
        </nav>

        <nav>
            <div id="mySideBottomnav" class="bottomnavmenu">
                <div class="row">
                    <div class="col-sm-2">
                        <div class="well well-sm">
                            <div class="tcenter btn-group" id="navplayer">          
                                <a href="#" class="btn btn-inverse btn-sm"><i class="glyphicon glyphicon-backward"></i></a>
                                <a href="#" class="btn btn-inverse btn-sm"><i class="glyphicon glyphicon-stop"></i></a>
                                <a href="#" class="btn btn-inverse btn-sm"><i class="glyphicon glyphicon-play"></i></a>
                                <a href="#" class="btn btn-inverse btn-sm"><i class="glyphicon glyphicon-forward"></i></a>             
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="well well-sm">
                            <div class="row">
                                <div class="col-sm-2 text-center">MONDAY</div>
                                <div class="col-sm-2 text-center">TUESDAY</div>
                                <div class="col-sm-2 text-center">WEDNESDAY</div>
                                <div class="col-sm-2 text-center">THURSDAY</div>
                                <div class="col-sm-2 text-center">FRIDAY</div>
                                <div class="col-sm-2 text-center">SATURDAY</div>
                            </div>
                            <div class="row">
                                <div class="col-sm-2">
                                    <div class="row">
                                        <button class="btn-primary col-sm-1">01</button>
                                        <button class="btn-primary col-sm-1">04</button>
                                        <button class="btn-primary col-sm-1">07</button>
                                        <button class="btn-primary col-sm-1">10</button>
                                        <button class="btn-primary col-sm-1">13</button>
                                        <button class="btn-primary col-sm-1">16</button>
                                        <button class="btn-primary col-sm-1">19</button>
                                        <button class="btn-primary col-sm-1">22</button>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="row">
                                        <button class="btn-primary col-sm-1">01</button>
                                        <button class="btn-primary col-sm-1">04</button>
                                        <button class="btn-primary col-sm-1">07</button>
                                        <button class="btn-primary col-sm-1">10</button>
                                        <button class="btn-primary col-sm-1">13</button>
                                        <button class="btn-primary col-sm-1">16</button>
                                        <button class="btn-primary col-sm-1">19</button>
                                        <button class="btn-primary col-sm-1">22</button>
                                    </div>
                                </div>    
                            </div>
                        </div>
                    </div>
                </div>                
            </div>
        </nav>
	<div id="loadingMessage">This is Just Testing :)</div>
{% endblock %}

        {% block conten_js %}

        <script type="text/javascript">

            var targetSiteLocation;

            var layerDataGeoJSONFormat = new ol.format.GeoJSON();

            var windDataSource = new ol.source.Vector({
                    format: layerDataGeoJSONFormat,
                    projection: 'EPSG:3857',
                    });

            var windClusterDataSource = new ol.source.Cluster({source : windDataSource});

            var wind925DataSource = new ol.source.Vector({
                    format: layerDataGeoJSONFormat,
                    projection: 'EPSG:3857',
                    });

            var wind975DataSource = new ol.source.Vector({
                    format: layerDataGeoJSONFormat,
                    projection: 'EPSG:3857',
                    });

            var gustDataSource = new ol.source.Vector({
                    format: layerDataGeoJSONFormat,
                    projection: 'EPSG:3857',
                    });

            var wind925ClusterDataSource = new ol.source.Cluster({source : wind925DataSource});
            var wind975ClusterDataSource = new ol.source.Cluster({source : wind975DataSource});

            var gustClusterDataSource = new ol.source.Cluster({source : gustDataSource});

            function getColorCodeForWindSpeed(tws)
                {
                var strokeColor = [2,8,21,0.5];
                var arrowImageURL = windArrows[3];
                var twidth = 15;
                if(tws <= 5) 
                    {
                    strokeColor = [2, 8, 21, 0.5];  //'#020815';
                    twidth = 15;
            //      arrowImageURL = windArrows[0];  //"{% static 'synergymapviewer/images/arrows/gm_arrow.png' %}";
                    }
                else if(tws>5 && tws<10) 
                    {
                    strokeColor = [25, 140, 255,0.5];   //'#198cff';
                    twidth = 17;
            //      arrowImageURL = windArrows[1];  //"{% static 'synergymapviewer/images/arrows/bm_arrow.png' %}";
                    }
                else if(tws>=10) 
                    {
                    strokeColor = [270, 70 ,90, 0.5];//'#f61212';
                    twidth = 20;
            //      arrowImageURL = windArrows[2];  //"{% static 'synergymapviewer/images/arrows/rm_arrow.png' %}";
                    }
                return [strokeColor,twidth,arrowImageURL];                      
                }

            function getColorCodeForTemprature(tmp)
                    {
                    var strokeColor = [2,8,21,0.5];
                    var twidth = 15;
                    if(tmp <= 20) 
                        {
                        strokeColor = [2, 196, 21, 0.5];    //'#020815';
                        twidth = 15;
                        }
                    else if(tmp>20 && tmp<25) 
                        {
                        strokeColor = [25, 140, 255,0.5];   //'#198cff';
                        twidth = 17;
                        }
                    else if(tmp>=25) 
                        {
                        strokeColor = [270, 70 ,90, 0.5];//'#f61212';
                        twidth = 20;
                        }
                    return [strokeColor,twidth];                        
                    }
/*
            var wind10mLayerStyleFunction = function(feature)
                    {
                    var tval = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().wd_10m));
                    var ccodes = getColorCodeForTemprature(tval);

                    var cStyle = new ol.style.Circle({
                                fill: new ol.style.Fill({
                                color: ccodes[0] //'#1b465a',
                                }),
                            stroke: new ol.style.Stroke({
                                color: ccodes[0],
                                width: 3
                                }),
                            radius: ccodes[1]
                            });

                    var cText = new ol.style.Text({
                            text: tval.toString(),  // size.toString(),
                            fill: new ol.style.Fill({color: '#fff'}),
                            font: '15px sans-serif', 
                            });

                    return [new ol.style.Style({image: cStyle, text : cText})];     
                    };
*/          
            

            var wind10mLayerStyleFunction = function(feature)
                {
                
                var twdr10m = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().wd_10m));

               
                var arrowImage = new ol.style.Icon({
                        src: windArrows[3],  //"{% static 'synergymapviewer/images/arrows/gt_ar_24.png' %}",
                        rotateWithView: true,
                        rotation: twdr10m * (Math.PI / 180)
                        });

                return [new ol.style.Style({image: arrowImage})];           
                };

            var wind925mLayerStyleFunction = function(feature)
                {
                
                var twdr10m = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().wd_925m));

               
                var arrowImage = new ol.style.Icon({
                        src: windArrows[3],  //"{% static 'synergymapviewer/images/arrows/gt_ar_24.png' %}",
                        rotateWithView: true,
                        rotation: twdr10m * (Math.PI / 180)
                        });

                return [new ol.style.Style({image: arrowImage})];           
                };

            var wind975mLayerStyleFunction = function(feature)
                {
                
                var twdr10m = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().wd_975m));

               
                var arrowImage = new ol.style.Icon({
                        src: windArrows[3],  //"{% static 'synergymapviewer/images/arrows/gt_ar_24.png' %}",
                        rotateWithView: true,
                        rotation: twdr10m * (Math.PI / 180)
                        });

                return [new ol.style.Style({image: arrowImage})];           
                };                

            var windGustLayerStyleFunction = function(feature)
                {
                var twsGust = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().gust));
                
                var ccodes = getColorCodeForWindSpeed(twsGust);

                var triangleShape = new ol.style.RegularShape({
                      fill: new ol.style.Fill({color: ccodes[0]}),
                      stroke: new ol.style.Stroke({color: ccodes[0],width: 1}),
                      points: 3,
                      radius: ccodes[1],
                      rotation: Math.PI / 4,
                      angle: 0
                    });

                var cText = new ol.style.Text({
                        text: twsGust.toString(),   // size.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });

                return [new ol.style.Style({image: triangleShape, text : cText})];

                };         

            var windGustLayer = new ol.layer.Vector({
                    source: gustClusterDataSource,
                    style: windGustLayerStyleFunction,
                    layerid: 'windGust',
                    visible: false
                    });

            var wind10mLayer = new ol.layer.Vector({
                    source: windClusterDataSource,
                    style: wind10mLayerStyleFunction,
                    layerid: 'wind10m',
                    visible: false                   
                    });

            var wind925mbLayer = new ol.layer.Vector({
                    source: wind925ClusterDataSource,
                    style: wind925mLayerStyleFunction,
                    layerid: 'wind925mb',
                    visible: false             
                    });

            var wind975mbLayer = new ol.layer.Vector({
                    source: wind975ClusterDataSource,
                    style: wind975mLayerStyleFunction,
                    layerid: 'wind975mb',
                    visible: false                    
                    });

            var ws10mContDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var ws10mContLayerStyleFunction = function(feature)
                {
                var ccodes = feature.getProperties().fill;  
                var label = feature.getProperties().label;  
                var polyStyle = new ol.style.Style({
                            stroke: new ol.style.Stroke({
                                    color:  ccodes ,
                                    width: 1
                                    }),
                                fill: new ol.style.Fill({
                                    color:  ccodes 
                                    }),
                                text: new ol.style.Text({
                                text: label.toString(), // size.toString(),
                                    //
                                fill: new ol.style.Fill({color: '#000'}),
                                font: '10px sans-serif', 
                                })
                              });

                return [polyStyle];

                };

            var ws10mContLayer = new ol.layer.Vector({
                    source: ws10mContDataSource,
                    style: ws10mContLayerStyleFunction, 
                    layerid: 'ws10mCont',
                    opacity: 0.5,
                    visible: false    
                    });

            var contLayerStyleFunction = function(feature)
                {
                var ccodes = feature.getProperties().fill;  
                var label = feature.getProperties().label;  
                var polyStyle = new ol.style.Style({
                            stroke: new ol.style.Stroke({
                                    color:  ccodes ,
                                    width: 1
                                    }),
                                fill: new ol.style.Fill({
                                    color:  ccodes 
                                    }),
                                text: new ol.style.Text({
                                text: label.toString(), // size.toString(),
                                    //
                                fill: new ol.style.Fill({color: '#000'}),
                                font: '10px sans-serif', 
                                })
                              });

                return [polyStyle];

                };

            var prContDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var prContLayer = new ol.layer.Vector({
                    source: prContDataSource,
                    style: contLayerStyleFunction, 
                    layerid: 'prmslCont',
                    opacity: 1,
                    visible: false
                    });

            function getColorCodeForTCDC(tcdcVal)
                {
                var strokeColor = [2, 196, 21, 0.5];
                var twidth = 15;
                    
                if(tcdcVal == 999999 || tcdcVal==0)
                            {
                            tcdcVal = "";
                            strokeColor = [2, 2, 2,0];      //'#020815';
                            twidth = 10;
                            }   
                else if(tcdcVal < 26 && tcdcVal > 0) 
                    {
                    strokeColor = [2, 128, 21, 0.5];    //'#020815';
                    twidth = 15;
                    }
                else if(tcdcVal>=26 && tcdcVal<76) 
                    {
                    strokeColor = [25, 140, 255,0.5];   //'#198cff';
                    twidth = 17;
                    }
                else if(tcdcVal>=76) 
                    {
                    strokeColor = [270, 70 ,90, 0.5];//'#f61212';
                    twidth = 20;
                    }

                return [strokeColor,twidth];    
                };

            function getColorCodeForPRES(presVal)
                {
                var strokeColor = [2, 196, 21, 0.5];
                var twidth = 15;
                
                if(presVal == 999999)
                    {
                    presVal = "";
                    strokeColor = [2, 2, 2,0];  //'#020815';
                    twidth = 10;                    
                    }
                else if(presVal < 5000) 
                    {
                    strokeColor = [2, 128, 21, 0.5];    //'#020815';
                    twidth = 15;
                    }
                else if(presVal>=5000 && presVal<10000) 
                    {
                    strokeColor = [25, 140, 255,0.5];   //'#198cff';
                    twidth = 17;
                    }
                else if(presVal>=10000) 
                    {
                    strokeColor = [270, 70 ,90, 0.5];//'#f61212';
                    twidth = 20;
                    }
                return [strokeColor,twidth];    
                }

            var lclCloudDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var mclCloudDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var cclCloudDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var lclCloudClusterDataSource = new ol.source.Cluster({source : lclCloudDataSource});
            var mclCloudClusterDataSource = new ol.source.Cluster({source : mclCloudDataSource});
            var cclCloudClusterDataSource = new ol.source.Cluster({source : cclCloudDataSource});

            var lcblCloudDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var mcblCloudDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var ccblCloudDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var lcblCloudClusterDataSource = new ol.source.Cluster({source : lcblCloudDataSource});
            var mcblCloudClusterDataSource = new ol.source.Cluster({source : mcblCloudDataSource});
            var ccblCloudClusterDataSource = new ol.source.Cluster({source : ccblCloudDataSource});


            var tcdcLowStyleFunction = function(feature)
                {
                var tval = parseInt(feature.getProperties().features[0].getProperties().lcl);
                var ccodes = getColorCodeForTCDC(tval);
                var stval = "";
                if(tval > 0 && tval<=100)
                    stval = tval.toString();

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: stval,    // size.toString(),
                        fill: new ol.style.Fill({color: '#fff'})
                        });

                return [new ol.style.Style({image: diamondShape, text : cText})];
                };

            var tcdcMiddleStyleFunction = function(feature)
                {
                var tval = parseInt(feature.getProperties().features[0].getProperties().mcl);
                var ccodes = getColorCodeForTCDC(tval);
                var stval = "";
                if(tval > 0 && tval<=100)
                    stval = tval.toString();

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: stval,    // size.toString(),
                        fill: new ol.style.Fill({color: '#fff'})
                        });

                return [new ol.style.Style({image: diamondShape, text : cText})];

                };

            var tcdcConvectiveStyleFunction = function(feature)
                {
                var tval = parseInt(feature.getProperties().features[0].getProperties().ccl);
                var ccodes = getColorCodeForTCDC(tval);
                    var stval = "";
                    if(tval > 0 && tval<=100)
                            stval = tval.toString();

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: stval,    // size.toString(),
                        fill: new ol.style.Fill({color: '#fff'})
                        });

                return [new ol.style.Style({image: diamondShape, text : cText})];

                };  

            var presLowStyleFunction = function(feature)
                {
                var tval = parseInt(feature.getProperties().features[0].getProperties().lcbl);
                var ccodes = getColorCodeForPRES(tval);
                if(tval == 999999)
                    tval = "";

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: tval.toString(),  // size.toString(),
                        fill: new ol.style.Fill({color: '#fff'})
                        });

                return [new ol.style.Style({image: diamondShape, text : cText})];

                };

            var presMiddleStyleFunction = function(feature)
                {
                var tval = parseInt(feature.getProperties().features[0].getProperties().mcbl);
                var ccodes = getColorCodeForPRES(tval);
                if(tval == 999999)
                    tval = "";

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });
                var cText = new ol.style.Text({
                        text: tval.toString(),  // size.toString(),
                        fill: new ol.style.Fill({color: '#fff'})
                        });

                return [new ol.style.Style({image: diamondShape, text : cText})];

                };

            var presConvectiveStyleFunction = function(feature)
                {
                var tval = parseInt(feature.getProperties().features[0].getProperties().ccbl);
                var ccodes = getColorCodeForPRES(tval);
                if(tval == 999999)
                    tval = "";

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: tval.toString(),  // size.toString(),
                        fill: new ol.style.Fill({color: '#fff'})
                        });

                return [new ol.style.Style({image: diamondShape, text : cText})];

                };  

            var tcdcLowLayer = new ol.layer.Vector({
                source: lclCloudClusterDataSource,
                style: tcdcLowStyleFunction,
                layerid: 'tcdcLow',
                visible: false
                });

            var tcdcMiddleLayer = new ol.layer.Vector({
                source: mclCloudClusterDataSource,
                style: tcdcMiddleStyleFunction,
                layerid: 'tcdcMiddle',
                visible: false
                });

            var tcdcConvectiveLayer = new ol.layer.Vector({
                source: cclCloudClusterDataSource,
                style: tcdcConvectiveStyleFunction,
                layerid: 'tcdcConvective',
                visible: false
                });

            var presLowLayer = new ol.layer.Vector({
                source: lcblCloudClusterDataSource,
                style: presLowStyleFunction,
                layerid: 'presLow',
                visible: false
                });

            var presMiddleLayer = new ol.layer.Vector({
                source: mcblCloudClusterDataSource,
                style: presMiddleStyleFunction,
                layerid: 'presMiddle',
                visible: false
                });

            var presConvectiveLayer = new ol.layer.Vector({
                source: ccblCloudClusterDataSource,
                style: presConvectiveStyleFunction,
                layerid: 'presConvective',
                visible: false
                });

            function getColorCodeForWW3(ww3Val)
                {
                var strokeColor = [2, 196, 21, 0.5];
                var twidth = 15;
                
                if(ww3Val == 9999  || ww3Val == 0){
                    ww3Val = "";
                    strokeColor = [2, 2, 2, 0];   //'#020815';
                    twidth = 5;                    
                    }
                else if(ww3Val < 50) 
                    {
                    strokeColor = [2, 128, 21, 0.5];    //'#020815';
                    twidth = 15;
                    }
                else if(ww3Val>=50 && ww3Val<100) 
                    {
                    strokeColor = [25, 140, 255,0.5];   //'#198cff';
                    twidth = 17;
                    }
                else if(ww3Val>=100) 
                    {
                    strokeColor = [270, 70 ,90, 0.5];//'#f61212';
                    twidth = 20;
                    }
                return [strokeColor,twidth];    
                }

            function getColorCodeForWaveDir(ww3Val)
                {
                
                var strokeColor = [2, 196, 21, 0.5];
                var arrowImageURL = waveArrows[1];
                var twidth = 15;
                
                if(ww3Val == 9999){
                    ww3Val = "";
                    strokeColor = [2, 2, 2, 0.5];   //'#020815';
                    twidth = 10;                    
                    }
                else if(ww3Val < 50) 
                    {
                    strokeColor = [2, 128, 21, 0.5];    //'#020815';
                    twidth = 15;
                    arrowImageURL = waveArrows[1];
                    }
                else if(ww3Val>=50 && ww3Val<100) 
                    {
                    strokeColor = [25, 140, 255,0.5];   //'#198cff';
                    twidth = 17;
                    arrowImageURL = waveArrows[2];
                    }
                else if(ww3Val>=100) 
                    {
                    strokeColor = [270, 70 ,90, 0.5];//'#f61212';
                    twidth = 20;
                    arrowImageURL = waveArrows[3];
                    }
                return [strokeColor,twidth,arrowImageURL];  
                }

            var dsw1LayerStyleFunction = function(feature)
                {
                var tdsw1 = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().dsw1));
                var thsw1 = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().hsw1));

                var twidth = 15;
                
                var ccodes;
                var arrowImage;
                ccodes = getColorCodeForWaveDir(thsw1);

                if(tdsw1 == 9999)
                    {
                        tdsw1 = "";
                        return [new ol.style.Style({})];
                    }
                else
                    {
                    arrowImage = new ol.style.Icon({
                            src: ccodes[2],
                            rotation: tdsw1 * (Math.PI / 180)
                            });         
                    }
                return [new ol.style.Style({image: arrowImage})];
                };

            var dsw2LayerStyleFunction = function(feature)
                {
                var tdsw2 = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().dsw2));
                var thsw2 = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().hsw2));

                var twidth = 15;

                var ccodes;
                var arrowImage;
                ccodes = getColorCodeForWaveDir(thsw2);

                if(tdsw2 == 9999)
                    {
                        tdsw2 = "";
                        arrowImage = new ol.style.Icon({
                //            src: waveArrows[0],
                //            rotation: 0
                            });
                    return [new ol.style.Style({})];                   
                    }
                else
                    {
                    arrowImage = new ol.style.Icon({
                            src: ccodes[2],
                            rotation: tdsw2 * (Math.PI / 180)
                            });         
                    }
                return [new ol.style.Style({image: arrowImage})];           
                };  

            var hsw1LayerStyleFunction = function(feature)
                {   
                var thsw1 = Math.ceil(parseFloat(feature.getProperties().features[0].getProperties().hsw1));

                var twidth = 15;    
                var ccodes; 
                ccodes = getColorCodeForWW3(thsw1);

                if(thsw1 == 9999 || thsw1 == 0)
                    {
                        thsw1 = "";
                    }

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: thsw1.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });
                
                return [new ol.style.Style({image: diamondShape, text : cText})];

                };

            var hsw2LayerStyleFunction = function(feature)
                {   
                var thsw2 = Math.ceil(parseFloat(feature.getProperties().features[0].getProperties().hsw2));

                var twidth = 15;    
                var ccodes; 
                ccodes = getColorCodeForWW3(thsw2);

                if(thsw2 = 9999 || thsw2 == 0)
                    {
                        thsw2 = "";
                    }

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: thsw2.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });
                
                return [new ol.style.Style({image: diamondShape, text : cText})];

                };

            var tsw1LayerStyleFunction = function(feature)
                {   
                var ttsw1 = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().tsw1));

                var twidth = 15;    
                var ccodes; 
                ccodes = getColorCodeForWW3(ttsw1);

                if(ttsw1 == 9999 || ttsw1 == 0)
                    {
                        ttsw1 = "";
                    }

                var cStyle = new ol.style.Circle({
                            fill: new ol.style.Fill({
                            color: ccodes[0] //'#1b465a',
                            }),
                        stroke: new ol.style.Stroke({
                            color: ccodes[0],
                            width: 3
                            }),
                        radius: ccodes[1]
                        });

                var cText = new ol.style.Text({
                        text: ttsw1.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });
                
                return [new ol.style.Style({image: cStyle, text : cText})];

                };

            var tsw2LayerStyleFunction = function(feature)
                {   
                var ttsw2 = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().tsw2));

                var twidth = 15;    
                var ccodes; 
                ccodes = getColorCodeForWW3(ttsw2);

                if(ttsw2 == 9999 || ttsw2 == 0)
                    {
                        ttsw2 = "";
                    }

                var cStyle = new ol.style.Circle({
                            fill: new ol.style.Fill({
                            color: ccodes[0] //'#1b465a',
                            }),
                        stroke: new ol.style.Stroke({
                            color: ccodes[0],
                            width: 3
                            }),
                        radius: ccodes[1]
                        });

                var cText = new ol.style.Text({
                        text: ttsw2.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });
                
                return [new ol.style.Style({image: cStyle, text : cText})];

                };

            var whgtLayerStyleFunction = function(feature)
                {   
                var thsw2 = Math.ceil(parseFloat(feature.getProperties().features[0].getProperties().shwws));

                var twidth = 15;    
                var ccodes; 
                ccodes = getColorCodeForWW3(thsw2);

                if(thsw2 = 9999 || thsw2 == 0)
                    {
                        thsw2 = "";
                    }

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: thsw2.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });
                
                return [new ol.style.Style({image: diamondShape, text : cText})];

                };

            var swperLayerStyleFunction = function(feature)
                {   
                var ttsw1 = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().perpws));

                var twidth = 15;    
                var ccodes; 
                ccodes = getColorCodeForWW3(ttsw1);

                if(ttsw1 == 9999 || ttsw1 == 0)
                    {
                        ttsw1 = "";
                    }

                var cStyle = new ol.style.Circle({
                            fill: new ol.style.Fill({
                            color: ccodes[0] //'#1b465a',
                            }),
                        stroke: new ol.style.Stroke({
                            color: ccodes[0],
                            width: 3
                            }),
                        radius: ccodes[1]
                        });

                var cText = new ol.style.Text({
                        text: ttsw1.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });
                
                return [new ol.style.Style({image: cStyle, text : cText})];

                };

            var mpwwLayerStyleFunction = function(feature)
                {   
                var ttsw1 = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().mpww));

                var twidth = 15;    
                var ccodes; 
                ccodes = getColorCodeForWW3(ttsw1);

                if(ttsw1 == 9999 || ttsw1 == 0)
                    {
                        ttsw1 = "";
                    }

                var cStyle = new ol.style.Circle({
                            fill: new ol.style.Fill({
                            color: ccodes[0] //'#1b465a',
                            }),
                        stroke: new ol.style.Stroke({
                            color: ccodes[0],
                            width: 3
                            }),
                        radius: ccodes[1]
                        });

                var cText = new ol.style.Text({
                        text: ttsw1.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });
                
                return [new ol.style.Style({image: cStyle, text : cText})];

                };
            
            var dirpwsLayerStyleFunction = function(feature)
                {
                var tdsw2 = Math.floor(parseFloat(feature.getProperties().features[0].getProperties().dirpws));

                var twidth = 15;

                var ccodes;
                var arrowImage;
                ccodes = getColorCodeForWaveDir(tdsw2);

                if(tdsw2 == 9999)
                    {
                        tdsw2 = "";
                        arrowImage = new ol.style.Icon({
                //            src: waveArrows[0],
                //            rotation: 0
                            });
                    return [new ol.style.Style({})];                   
                    }
                else
                    {
                    arrowImage = new ol.style.Icon({
                            src: ccodes[2],
                            rotation: tdsw2 * (Math.PI / 180)
                            });         
                    }
                return [new ol.style.Style({image: arrowImage})];           
                };      

            var swhsLayerStyleFunction = function(feature)
                {   
                var thsw2 = Math.ceil(parseFloat(feature.getProperties().features[0].getProperties().swhs));

                var twidth = 15;    
                var ccodes; 
                ccodes = getColorCodeForWW3(thsw2);

                if(thsw2 = 9999 || thsw2 == 0)
                    {
                        thsw2 = "";
                    }

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: thsw2.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });
                
                return [new ol.style.Style({image: diamondShape, text : cText})];

                };

            var maxswhsLayerStyleFunction = function(feature)
                {   
                var thsw2 = Math.ceil(parseFloat(feature.getProperties().features[0].getProperties().swhs)*1.5);

                var twidth = 15;    
                var ccodes; 
                ccodes = getColorCodeForWW3(thsw2);

                if(thsw2 = 9999 || thsw2 == 0)
                    {
                        thsw2 = "";
                    }

                var diamondShape = new ol.style.RegularShape({
                        fill: new ol.style.Fill({color: ccodes[0]}),
                        stroke: new ol.style.Stroke({color: ccodes[0] ,width: 1}),
                        points: 6,
                        radius: ccodes[1],
                        angle: Math.PI / 6
                        });

                var cText = new ol.style.Text({
                        text: thsw2.toString(),
                        fill: new ol.style.Fill({color: '#000'})
                        });
                
                return [new ol.style.Style({image: diamondShape, text : cText})];

                };

            var dsw1DataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var dsw1ClusterDataSource = new ol.source.Cluster({source : dsw1DataSource});

            var dsw1Layer = new ol.layer.Vector({
                source: dsw1ClusterDataSource,
                style: dsw1LayerStyleFunction,
                layerid: 'dsw1',
                visible: false
                });

            var hsw1DataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var hsw1ClusterDataSource = new ol.source.Cluster({source : hsw1DataSource});

            var hsw1Layer = new ol.layer.Vector({
                source: hsw1ClusterDataSource,
                style: hsw1LayerStyleFunction,
                layerid: 'hsw1',
                visible: false
                });

            var tsw1DataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var tsw1ClusterDataSource = new ol.source.Cluster({source : tsw1DataSource});

            var tsw1Layer = new ol.layer.Vector({
                source: tsw1ClusterDataSource,
                style: tsw1LayerStyleFunction,
                layerid: 'tsw1',
                visible: false
                });

            var dsw2DataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var dsw2ClusterDataSource = new ol.source.Cluster({source : dsw2DataSource});

            var dsw2Layer = new ol.layer.Vector({
                source: dsw2ClusterDataSource,
                style: dsw2LayerStyleFunction,
                layerid: 'dsw2',
                visible: false
                });

            var hsw2DataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var hsw2ClusterDataSource = new ol.source.Cluster({source : hsw2DataSource});

            var hsw2Layer = new ol.layer.Vector({
                source: hsw2ClusterDataSource,
                style: hsw2LayerStyleFunction,
                layerid: 'hsw2',
                visible: false
                });

            var tsw2DataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });
            
            var tsw2ClusterDataSource = new ol.source.Cluster({source : tsw2DataSource});

            var tsw2Layer = new ol.layer.Vector({
                source: tsw2ClusterDataSource,
                style: tsw2LayerStyleFunction,
                layerid: 'tsw2',
                visible: false
                });

            var whgtDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var whgtClusterDataSource = new ol.source.Cluster({source : whgtDataSource});

            var whgtLayer = new ol.layer.Vector({
                source: whgtClusterDataSource,
                style: whgtLayerStyleFunction,
                layerid: 'whgt',
                visible: false
                });

            var swperDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var swperClusterDataSource = new ol.source.Cluster({source : swperDataSource});

            var swperLayer = new ol.layer.Vector({
                source: swperClusterDataSource,
                style: swperLayerStyleFunction,
                layerid: 'perpws',
                visible: false
                });

            var mpwwDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var mpwwClusterDataSource = new ol.source.Cluster({source : mpwwDataSource});

            var mpwwLayer = new ol.layer.Vector({
                source: mpwwClusterDataSource,
                style: mpwwLayerStyleFunction,
                layerid: 'mpww',
                visible: false
                });

            var dirpwsDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var dirpwsClusterDataSource = new ol.source.Cluster({source : dirpwsDataSource});

            var dirpwsLayer = new ol.layer.Vector({
                source: dirpwsClusterDataSource,
                style: dirpwsLayerStyleFunction,
                layerid: 'dirpws',                
                visible: false
                });

            var swhsDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var swhsClusterDataSource = new ol.source.Cluster({source : swhsDataSource});

            var swhsLayer = new ol.layer.Vector({
                source: swhsClusterDataSource,
                style: swhsLayerStyleFunction,
                layerid: 'swhs',
                visible: false
                });


            var maxswhsDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var maxswhsClusterDataSource = new ol.source.Cluster({source : maxswhsDataSource});

            var maxswhsLayer = new ol.layer.Vector({
                source: maxswhsClusterDataSource,
                style: maxswhsLayerStyleFunction,
                layerid: 'maxswhs',
                visible: false
                });

            var tmp2mContDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var tmp2mContLayer = new ol.layer.Vector({
                source: tmp2mContDataSource,
                style: contLayerStyleFunction,
                layerid: 'tmp2mCont',
                opacity: 0.5,
                visible: false
                });

            var hmdt2mContDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var hmdt2mContLayer = new ol.layer.Vector({
                    source: hmdt2mContDataSource,
                    style: contLayerStyleFunction, 
                    layerid: 'hmdt2mCont',
                    opacity: 0.5,
                    visible: false
                    });

            var apcpContDataSource = new ol.source.Vector({
                format: layerDataGeoJSONFormat,
                projection: 'EPSG:3857',
                });

            var apcpContLayer = new ol.layer.Vector({
                    source: apcpContDataSource,
                    style: contLayerStyleFunction, 
                    layerid: 'apcpCont',
                    opacity: 0.5,
                    visible: false
                    });

            var pointFeature = new ol.Feature(new ol.geom.Point([0, 0]));

            var siteSelectionVectorLayer = new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: []
                    }),
                style: new ol.style.Style({
                    image: new ol.style.Icon(({
                        src: start_map_pin
                        }))
                    })
                });

            var map = new ol.Map({
                target: 'map',
                layers: [
                        new ol.layer.Tile({
                        source: new ol.source.OSM()}),
                        windGustLayer,
                        wind10mLayer,
                        wind925mbLayer,
                        wind975mbLayer,
                        ws10mContLayer,
                        tmp2mContLayer,
                        hmdt2mContLayer,
                        tcdcLowLayer,
                        tcdcMiddleLayer,
                        tcdcConvectiveLayer,
                        presLowLayer,
                        presMiddleLayer,
                        presConvectiveLayer,
                        apcpContLayer,
                        dsw1Layer,
                        dsw2Layer,              
                        hsw1Layer,
                        hsw2Layer,
                        tsw1Layer,
                        tsw2Layer,
                        whgtLayer,
                        swperLayer,
                        mpwwLayer,
                        dirpwsLayer,
                        swhsLayer,
                        maxswhsLayer,
                        prContLayer,
                        siteSelectionVectorLayer
                    ],
                view: new ol.View({
                    center: ol.proj.fromLonLat([37.41, 8.82], 'EPSG:4326', 'EPSG:3857'),
                    zoom: 4
                    }),

                });

            $('.leftmenu').on('click', function (e) 
                {
                $('.leftmenu').toggleClass("leftmenuexpand");
                $('.leftnavmenu').toggleClass("leftnavmenuexpand");
                
                if($('#layersmenu').hasClass('leftmenu'))
                    {
                    $('#layersmenu').html("&#9776");
                    }
                if($('#layersmenu').hasClass('leftmenuexpand'))
                    {
                    $('#layersmenu').html("&#x2715"); 
                    }
                //$('#layersmenu').html($('#layersmenu').text() == "&#x2715" ? "&#9776" : "&#x2715");
                });

            $('.rightmenu').on('click', function (e) 
                {
                $('.rightmenu').toggleClass("rightmenuexpand");
                $('.rightnavmenu').toggleClass("rightnavmenuexpand");

                if($('#chartsmenu').hasClass('rightmenu'))
                    {
                    $('#chartsmenu').html("&#9776");
                    }
                if($('#chartsmenu').hasClass('rightmenuexpand'))
                    {
                    $('#chartsmenu').html("&#x2715"); 
                    }
                });

            $('.bottommenu').on('click', function (e) 
                {                    
                $('.bottommenu').toggleClass("bottommenuexpand");
                $('.bottomnavmenu').toggleClass("bottomnavmenuexpand");
                if($('#datanavmenu').hasClass('bottommenu'))
                    {                    
                    $('#datanavmenu').html("&#9776");                        
                    }
                if($('#datanavmenu').hasClass('bottommenuexpand'))
                    {
                    $('#datanavmenu').html("&#x2715");                         
                    }
                });

            $('.topmenu').on('click', function (e) 
                {
                $('.topmenu').toggleClass("topmenuexpand"); 
                $('.topnavmenu').toggleClass("topnavmenuexpand");                   
                if($('#legendsmenu').hasClass('topmenu'))
                    {
                    $('#legendsmenu').html("&#9776");
                    }
                if($('#legendsmenu').hasClass('topmenuexpand'))
                    {
                    $('#legendsmenu').html("&#x2715"); 
                    }
                });

            $("#windGustVisible").change(
                function(){
                map.getLayer('windGust').setVisible($(this).prop("checked"));
                });

            $("#wind10mVisible").change(
                function(){
                    map.getLayer('wind10m').setVisible($(this).prop("checked"));
                });

            $("#wind925mbVisible").change(
                function(){
                    map.getLayer('wind925mb').setVisible($(this).prop("checked"));
                });     

            $("#wind975mbVisible").change(
                function(){
                    map.getLayer('wind975mb').setVisible($(this).prop("checked"));
                });

            $("#wind10mCPVisible").change(
                function(){
                    map.getLayer('ws10mCont').setVisible($(this).prop("checked"));
                });
                                            
            $("#temprature2mCPVisible").change(
                function(){
                    map.getLayer('tmp2mCont').setVisible($(this).prop("checked"));
                });

            $("#humidity2mCPVisible").change(
                function(){
                    map.getLayer('hmdt2mCont').setVisible($(this).prop("checked"));
                });            

            $("#apcpVisible").change(
                function(){
                    map.getLayer('apcpCont').setVisible($(this).prop("checked"));
                });

            $("#pressureMSLILVisible").change(
                function(){
                    map.getLayer('prmslCont').setVisible($(this).prop("checked"));
                });   
            
            $("#tcdcLowVisible").change(
                function(){
                map.getLayer('tcdcLow').setVisible($(this).prop("checked"));
                });

            $("#tcdcMiddleVisible").change(
                function(){
                map.getLayer('tcdcMiddle').setVisible($(this).prop("checked"));
                });

            $("#tcdcConvectiveVisible").change(
                function(){
                map.getLayer('tcdcConvective').setVisible($(this).prop("checked"));
                });

            $("#presLowVisible").change(
                function(){
                map.getLayer('presLow').setVisible($(this).prop("checked"));
                });

            $("#presMiddleVisible").change(
                function(){
                map.getLayer('presMiddle').setVisible($(this).prop("checked"));
                });

            $("#presConvectiveVisible").change(
                function(){
                map.getLayer('presConvective').setVisible($(this).prop("checked"));
                });

            $("#dsw1Visible").change(
                function(){
                    map.getLayer('dsw1').setVisible($(this).prop("checked"));
                    });

            $("#dsw2Visible").change(
                function(){
                    map.getLayer('dsw2').setVisible($(this).prop("checked"));
                    });

            $("#hsw1Visible").change(
                function(){
                    map.getLayer('hsw1').setVisible($(this).prop("checked"));
                    });

            $("#hsw2Visible").change(
                function(){
                    map.getLayer('hsw2').setVisible($(this).prop("checked"));
                    });

            $("#tsw1Visible").change(
                function(){
                    map.getLayer('tsw1').setVisible($(this).prop("checked"));
                    });

            $("#tsw2Visible").change(
                function(){
                    map.getLayer('tsw2').setVisible($(this).prop("checked"));
                    });

            $("#swhgtVisible").change(
                function(){
                    map.getLayer('whgt').setVisible($(this).prop("checked"));
                    });

            $("#perpwsVisible").change(
                function(){
                    map.getLayer('perpws').setVisible($(this).prop("checked"));
                    });

            $("#mpwwVisible").change(
                function(){
                    map.getLayer('mpww').setVisible($(this).prop("checked"));
                    });

            $("#dirpwsVisible").change(
                function(){
                    map.getLayer('dirpws').setVisible($(this).prop("checked"));
                    });

            $("#swhsVisible").change(
                function(){
                    map.getLayer('swhs').setVisible($(this).prop("checked"));
                    });
            $("#maxshwsVisible").change(
                function(){
                    map.getLayer('maxswhs').setVisible($(this).prop("checked"));
                    });
            var marker = function(obj)
                    {                    
                    siteSelectionVectorLayer.getSource().clear();
                    var coord4326 = ol.proj.transform(obj.coordinate, 'EPSG:3857', 'EPSG:4326');
//                    console.log(obj.coordinate);       
//                    console.log(coord4326);             
                    targetSiteLocation = coord4326;
                    var  template = '[ {x} | {y} ]',
                        iconStyle = new ol.style.Style({
                          image: new ol.style.Icon({
                            scale: .6,
                            src: url_marker
                          }),
                          text: new ol.style.Text({
                            offsetY: 25,
                            text: ol.coordinate.format(coord4326, template, 2),
                            font: '15px Open Sans,sans-serif',
                            fill: new ol.style.Fill({ color: '#111' }),
                            stroke: new ol.style.Stroke({
                              color: '#eee', width: 2
                            })
                          })
                        }),
                    feature = new ol.Feature({
                          type: 'removable',
                          geometry: new ol.geom.Point(obj.coordinate)
                        });
                      
                      feature.setStyle(iconStyle);
                      siteSelectionVectorLayer.getSource().addFeature(feature);
                    };

            var contextmenu_items = [
                    {
                      text: 'Set Site Location',
                      icon: url_marker,
                      callback: marker
                    }];

            var contextmenu = new ContextMenu({
                    width: 190,
                    default_items: true,
                    items: contextmenu_items
                    });

            map.addControl(contextmenu);
            


        </script>
        {% endblock %}

